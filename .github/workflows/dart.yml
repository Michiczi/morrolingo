name: morrolingo

on:
Â  workflow_dispatch:

jobs:
Â  build-ios:
Â  Â  name: ðŸŽ‰ iOS Build for Sideloading
Â  Â  runs-on: macos-latest
Â  Â  steps:
Â  Â  Â  - uses: actions/checkout@v3

Â  Â  Â  - uses: subosito/flutter-action@v2
Â  Â  Â  Â  with:
Â  Â  Â  Â  Â  channel: 'stable'
Â  Â  Â  Â  Â  architecture: x64

Â  Â  Â  - name: Set iOS deployment target to 17 in Podfile
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  sed -i '' "s/platform :ios, '15.5'/platform :ios, '17.0'/g" ios/Podfile

Â  Â  Â  - name: Force iOS Deployment Target in Xcode project
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  sed -i '' "s/IPHONEOS_DEPLOYMENT_TARGET = 18.0;/IPHONEOS_DEPLOYMENT_TARGET = 17.0;/g" ios/Runner.xcodeproj/project.pbxproj

Â  Â  Â  - name: Clean build environment
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  flutter clean

Â  Â  Â  - name: Install dependencies
Â  Â  Â  Â  run: flutter pub get

Â  Â  Â  - name: Install Pods
Â  Â  Â  Â  run: pod install
Â  Â  Â  Â  working-directory: ios

Â  Â  Â  # Krok: Kompilacja niepodpisanej aplikacji
Â  Â  Â  - name: Build unsigned.app file
Â  Â  Â  Â  run: flutter build ios --release --no-codesign

Â  Â  Â  # Krok: Tworzenie folderu "Payload"
Â  Â  Â  - name: Prepare Payload directory
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  mkdir -p Payload
Â  Â  Â  Â  working-directory: build/ios/iphoneos

Â  Â  Â  # Krok: Przenoszenie pliku.app do "Payload"
Â  Â  Â  - name: Move app bundle to Payload
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  mv Runner.app Payload/
Â  Â  Â  Â  working-directory: build/ios/iphoneos

Â  Â  Â  # Krok: Zipping do.ipa
Â  Â  Â  - name: Zip to.ipa
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  zip -r -y morrolingo.ipa Payload/
Â  Â  Â  Â  working-directory: build/ios/iphoneos

Â  Â  Â  # Krok: Upload pliku.ipa jako artefaktu
Â  Â  Â  - name: Upload unsigned.ipa as artifact
Â  Â  Â  Â  uses: actions/upload-artifact@v3
Â  Â  Â  Â  with:
Â  Â  Â  Â  Â  name: Unsigned-morrolingo-ipa
Â  Â  Â  Â  Â  path: build/ios/iphoneos/morrolingo.ipa
